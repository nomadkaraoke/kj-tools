<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KJ Remote</title>
    <style>
        body { font-family: sans-serif; background-color: #282c34; color: #abb2bf; max-width: 800px; margin: 2rem auto; padding: 1rem; }
        .container { background-color: #353a42; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        h2 { color: #61afef; border-bottom: 2px solid #61afef; padding-bottom: 0.5rem; }
        input[type="text"], input[type="url"] { width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #4f5661; background-color: #2c313a; color: #abb2bf; }
        button { background-color: #61afef; color: #282c34; border: none; padding: 12px 18px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
        button:hover { background-color: #529bdf; }
        .button-group button { margin-right: 10px; }
        #status-bar { margin-top: 1rem; padding: 1rem; background-color: #2c313a; border-radius: 4px; }
        #log-area { margin-top: 1rem; padding: 1rem; background-color: #21252b; border-radius: 4px; height: 150px; overflow-y: scroll; font-family: monospace; font-size: 0.9em; }
        .log-entry { padding: 2px 0; border-bottom: 1px solid #353a42; }
        .log-entry.error { color: #e06c75; }
        .log-entry.success { color: #98c379; }
    </style>
</head>
<body>

    <h1>üé§ KJ Remote Control</h1>

    <div class="container">
        <h2>üì• Download Song</h2>
        <input type="url" id="youtube-url" placeholder="Enter YouTube URL">
        <button onclick="downloadSong()">Download</button>
    </div>

    <div class="container">
        <h2>‚ñ∂Ô∏è Play Song</h2>
        <input type="text" id="video-id" placeholder="Enter Video ID">
        <button onclick="playSong()">Play</button>
    </div>

    <div class="container">
        <h2>‚èØÔ∏è Playback Controls</h2>
        <div class="button-group">
            <button onclick="controlPlayback('pause_resume')">Pause / Resume</button>
            <button onclick="controlPlayback('restart')">Restart</button>
            <button onclick="controlPlayback('stop')">Stop & Play Music</button>
        </div>
    </div>

    <div id="status-bar">
        <strong>Status:</strong> <span id="player-state">Unknown</span> | 
        <strong>Current Video:</strong> <span id="current-video">None</span> | 
        <strong>Time:</strong> <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
    </div>

    <div id="log-area"></div>

    <script>
        const logArea = document.getElementById('log-area');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logArea.prepend(entry);
        }

        async function apiCall(endpoint, body) {
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'API request failed');
                }
                return data;
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                return null;
            }
        }

        async function downloadSong() {
            const url = document.getElementById('youtube-url').value;
            if (!url) {
                log('Please enter a YouTube URL.', 'error');
                return;
            }
            log(`Downloading: ${url}`);
            const data = await apiCall('/download', { url });
            if (data && data.success) {
                log(`Downloaded "${data.title}" successfully! ID: ${data.video_id}`, 'success');
                document.getElementById('video-id').value = data.video_id;
                document.getElementById('youtube-url').value = '';
            }
        }

        async function playSong() {
            const videoId = document.getElementById('video-id').value;
            if (!videoId) {
                log('Please enter a Video ID.', 'error');
                return;
            }
            log(`Playing video ID: ${videoId}`);
            await apiCall('/play', { video_id: videoId });
        }

        async function controlPlayback(action) {
            log(`Sending control: ${action}`);
            await apiCall('/control', { action });
        }

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return "0:00";
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${min}:${sec}`;
        }

        async function updateStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();
                if (response.ok) {
                    document.getElementById('player-state').textContent = data.state || 'unknown';
                    document.getElementById('current-video').textContent = data.current_video_id || 'None';
                    document.getElementById('current-time').textContent = formatTime(data.time);
                    document.getElementById('total-time').textContent = formatTime(data.length);
                }
            } catch (error) {
                // Don't log periodic status check errors to avoid clutter
            }
        }

        // Update status every 2 seconds
        setInterval(updateStatus, 2000);
        log('KJ Remote initialized.');
    </script>

</body>
</html>
